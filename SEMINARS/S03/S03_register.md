# S03 - Реестр NFR (Given-When-Then)

## Поля реестра (data dictionary)

* **ID** - короткий идентификатор, например `NFR-001`.
* **User Story / Feature** - к какой истории/фиче относится требование (ссылка допустима).
* **Category** - выберите из банка (напр.: `Performance`, `Security-AuthZ/RBAC`, `RateLimiting`, `Privacy/PII`, `Observability/Logging`, …).
* **Requirement (NFR)** - *измеримое* требование (числа/пороги/границы действия).
* **Rationale / Risk** - зачем это нужно, какой риск/ценность покрываем.

## Таблица реестра

| ID                      | User Story / Feature                  | Category                 | Requirement (NFR)                                                                                                                                                      | Rationale / Risk                                                                            |
|-------------------------|---------------------------------------|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| **NFR-SEC-AUTH-002**    | As a user I register a new account    | Security-AuthN           | Пароль должен соответствовать политике сложности: минимум 12 символов, содержать буквы разного регистра, цифры и спецсимволы.                                          | Снижение риска подбора пароля и компрометации учетной записи.                               |
| **NFR-SEC-CONF-001**    | As a user I register a new account    | Security-Confidentiality | Пароль пользователя должен сохраняться в базе данных в виде криптографического хеша с использованием индивидуальной соли (например, bcrypt).                           | Защита паролей пользователей в случае утечки базы данных.                                   |
| **NFR-SEC-DOS-001**     | As a user I try to login              | Security-Availability    | Эндпоинт входа в систему ограничен 10 попытками в минуту с одного IP. Превышение возвращает 429.                                                                       | Защита от brute-force атак на пароли пользователей.                                         |
| **NFR-SEC-AUTHZ-001**   | As a user I view my order history     | Security-AuthZ/RBAC      | Пользователь `user-A` не может читать заказы пользователя `user-B`. Доступ к `GET /api/orders/{orderId}` должен проверять принадлежность заказа текущему пользователю. | Изоляция данных пользователей, предотвращение несанкционированного доступа к чужим заказам. |
| **NFR-SEC-SECRETS-001** | As a developer I connect to the DB    | Security-Secrets         | В репозитории и его истории отсутствуют секреты (ключи API, пароли). Они загружаются во время выполнения из защищенного хранилища.                                     | Предотвращение утечки критически важных секретов через исходный код.                        |
| **NFR-SEC-VALID-001**   | As a user I submit any data           | Security-InputValidation | Все данные, поступающие от клиента, должны проходить валидацию на стороне сервера (формат, длина, разрешенные символы).                                                | Защита от XSS, SQL Injection и других атак, связанных с некорректными входными данными.     |
| **NFR-SEC-TLS-001**     | As a user I connect to the site       | Security-Confidentiality | Весь трафик между клиентом и сервером должен шифроваться с использованием TLS 1.2 или выше.                                                                            | Защита от перехвата и модификации данных в пути (MitM-атаки).                               |
| **NFR-SEC-PII-001**     | As a user I view my profile           | Security-Privacy/PII     | В ответах API и логах чувствительные данные (например, полный адрес доставки) должны маскироваться по умолчанию.                                                       | Снижение риска утечки персональных данных.                                                  |
| **NFR-API-IDEMP-001**   | As a user I pay for an order          | Idempotency              | Критичные операции (создание заказа, платёж) должны поддерживать Idempotency-Key для защиты от двойного выполнения.                                                    | Предотвращение дублирования заказов и двойных списаний средств при сбоях сети.              |
| **NFR-CMP-PCI-001**     | As a user I pay for an order          | Security-PCI             | Приложение не должно хранить полные данные банковских карт; вся обработка должна происходить на стороне PCI-DSS сертифицированного провайдера.                         | Снижение риска утечки карточных данных и соответствие требованиям платёжных систем.         |
| **NFR-SEC-INT-001**     | As a service I receive payment status | Security-Integrity       | Все входящие webhook'и от внешних систем должны проверяться с помощью цифровой подписи (например, HMAC-SHA256).                                                        | Защита от поддельных уведомлений, которые могут привести к мошенническим операциям.         |