# S04 - Приоритизация рисков L×I (risk scoring)

## Таблица приоритизации

| Risk ID  | Source (DFD/Row)          | Consolidated Description                                                                                                                                        | Threat (S/T/R/I/D/E) | NFR link (ID)                                     | L (1-5) | Rationale-L                                                                                                   | I (1-5) | Rationale-I                                                                                             | **Score (=L×I)** | Decision (Top-5?) | ADR candidate                      |
|----------|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|---------------------------------------------------|--------:|---------------------------------------------------------------------------------------------------------------|--------:|---------------------------------------------------------------------------------------------------------|-----------------:|-------------------|------------------------------------|
| **R-01** | DB, Store Service, API GW | **Массовая утечка PII:** Персональные данные пользователей (PII) могут быть раскрыты через API, утечь из логов или быть украдены из незашифрованной БД/бэкапов. | I                    | **NFR-SEC-PII-001, NFR-SEC-CONF-001**             |       4 | Очень распространенная проблема, вызванная ошибками конфигурации логгеров или отсутствием шифрования at-rest. |       5 | **Критичный.** Массовая утечка ПДн ведет к огромным штрафам (GDPR), потере репутации и судебным искам.  |               20 | **Top-1**         | PII Encryption & Masking Strategy  |
| **R-02** | Store Service             | **Обход авторизации (IDOR):** Пользователь получает доступ к чужим данным (заказам, профилю), манипулируя идентификаторами в запросах.                          | E, I, T              | **NFR-SEC-AUTHZ-001**                             |       5 | Одна из самых частых уязвимостей в веб-приложениях (OWASP Top 10), легко эксплуатируется.                     |       3 | **Значимый.** Прямого финансового ущерба нет, но это серьезное нарушение приватности и удар по доверию. |               15 | **Top-2**         | Centralized AuthZ Middleware       |
| **R-03** | External (edge)           | **Подделка статуса платежа:** Атакующий отправляет поддельный webhook-запрос, имитируя успешную оплату и заставляя систему бесплатно отгрузить товар.           | S, T                 | **NFR-SEC-INT-001**                               |       3 | Требует знания эндпоинта и формата, но реализуемо. Риск возрастает, если документация API публична.           |       4 | **Высокий.** Прямые финансовые потери для магазина, которые сложно отследить без аудита.                |               12 | **Top-3**         | Webhook Signature Validation       |
| **R-04** | Store Service             | **Манипуляция бизнес-логикой:** Атакующий изменяет параметры в API-запросах (например, цену или количество товара) для получения финансовой выгоды.             | T                    | **NFR-SEC-VALID-001, (need NFR: Data-Integrity)** |       3 | Требует технической смекалки, но является стандартным вектором атаки на e-commerce платформы.                 |       4 | **Высокий.** Прямые финансовые потери, нарушение целостности данных о заказах и остатках на складе.     |               12 | **Top-4**         | Server-Side Validation & Integrity |
| **R-05** | Internet → API (edge)     | **Захват учетной записи (ATO):** Атакующий крадет JWT-токен пользователя (через XSS, MitM) и использует его для получения полного доступа к аккаунту.           | S, I                 | **NFR-SEC-AUTH-002, NFR-SEC-TLS-001**             |       4 | Кража токенов — очень распространенный сценарий атаки.                                                        |       3 | **Значимый.** Компрометация одного пользователя — это серьезно, но не затрагивает всю систему.          |               12 | **Top-5**         | Secure Token Handling (JWT)        |
| **R-06** | API Gateway, Internet     | **Отказ в обслуживании (DoS):** Сервис становится недоступен для легитимных пользователей из-за лавины запросов на публичные эндпоинты.                         | D                    | **NFR-SEC-DOS-001**                               |       4 | DoS-атаки легко автоматизировать и запустить, особенно на уровне приложения.                                  |       2 | **Умеренный.** Приводит к временному простою и потере репутации, но обычно не к потере данных.          |                8 |                   | Rate Limiting & WAF Strategy       |

## Сводка (Top-5)

После сортировки по **Score** итоговый список:

*   **Top-1: `R-01` - Массовая утечка PII (Score 20).** Риск максимален из-за критического влияния (I=5) на бизнес и клиентов в случае реализации, при этом вероятность утечки из-за ошибок конфигурации высока (L=4). **ADR candidate:** `PII Encryption & Masking Strategy`.
*   **Top-2: `R-02` - Обход авторизации (IDOR) (Score 15).** Самая высокая вероятность реализации (L=5) из-за распространенности данной уязвимости. Даже при среднем импакте (I=3) это делает ее критически важной для исправления. **ADR candidate:** `Centralized AuthZ Middleware`.
*   **Top-3: `R-03` - Подделка статуса платежа (Score 12).** Высокий финансовый импакт (I=4) делает эту угрозу приоритетной, несмотря на среднюю вероятность. **ADR candidate:** `Webhook Signature Validation`.
*   **Top-4: `R-04` - Манипуляция бизнес-логикой (Score 12).** Аналогично R-03, высокий финансовый импакт (I=4) требует немедленного внимания. **ADR candidate:** `Server-Side Validation & Integrity`.
*   **Top-5: `R-05` - Захват учетной записи (ATO) (Score 12).** Высокая вероятность (L=4) и значимый импакт на доверие пользователей (I=3) делают этот риск важным для контроля. **ADR candidate:** `Secure Token Handling (JWT)`.